<!doctype html>
<html lang="ca">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Calculadora Visual â€” Codi de Colors dels Resistors (4 bandes)</title>
<style>
/* ---------------------------
   RESET & BASE
   --------------------------- */
:root{
  --bg-1: #071226;
  --bg-2: #071a2d;
  --glass: rgba(255,255,255,0.03);
  --card: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
  --muted: #9fb0c8;
  --accent: linear-gradient(90deg,#4f46e5,#06b6d4);
  --accent-solid: #4f46e5;
  --accent-2: #06b6d4;
  --radius: 14px;
  --glass-2: rgba(255,255,255,0.02);
  --glass-3: rgba(255,255,255,0.015);
  --soft: rgba(255,255,255,0.04);
  font-family: Inter, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  color-scheme: dark;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background: radial-gradient(1200px 600px at 10% 10%, #072034 0%, rgba(7,18,36,0) 20%), linear-gradient(180deg,var(--bg-1),var(--bg-2));
  color:#e6f0fb;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  padding:24px;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* ---------------------------
   LAYOUT
   --------------------------- */
.app{
  width:100%;
  max-width:1200px;
  margin:0 auto;
  display:grid;
  grid-template-columns: 1fr 380px;
  gap:20px;
}
@media (max-width:1050px){
  .app{grid-template-columns:1fr; padding:12px}
}

.header{
  grid-column: 1 / -1;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}
.brand{
  display:flex;
  gap:12px;
  align-items:center;
}
.logo{
  width:56px;height:56px;border-radius:12px;
  background: linear-gradient(135deg,#06b6d4,#4f46e5);
  display:flex;align-items:center;justify-content:center;
  box-shadow: 0 8px 30px rgba(6,182,212,0.12), inset 0 -6px 16px rgba(0,0,0,0.25);
  font-weight:700;font-size:18px;color:white;
}
.title h1{margin:0;font-size:18px}
.title p{margin:0;color:var(--muted);font-size:13px}

/* ---------------------------
   CARD
   --------------------------- */
.card{
  background:var(--card);
  border-radius:var(--radius);
  padding:18px;
  box-shadow: 0 10px 30px rgba(2,6,23,0.6);
  border: 1px solid rgba(255,255,255,0.03);
}

/* ---------------------------
   TABS & CONTROLS
   --------------------------- */
.controls{
  display:flex;
  gap:8px;
  margin-bottom:12px;
  align-items:center;
  justify-content:space-between;
  flex-wrap:wrap;
}
.mode-switch{display:flex;gap:8px}
.switch-btn{
  padding:8px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:600;
  background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.02);
}
.switch-btn.active{
  background:var(--accent-solid);
  color:white;
  box-shadow:0 8px 32px rgba(79,70,229,0.18);
}

/* ---------------------------
   FORM
   --------------------------- */
.form-grid{
  display:grid;
  grid-template-columns: repeat(2,1fr);
  gap:12px;
}
@media (max-width:600px){ .form-grid{grid-template-columns:1fr} }

label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
select,input[type="text"],input[type="number"]{
  width:100%;
  padding:10px 12px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.03);
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
  color:inherit;
  outline:none;
}

/* Primary button */
.btn{
  display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;border:0;cursor:pointer;
  background:linear-gradient(90deg,#4f46e5,#06b6d4);
  color:white;font-weight:700;box-shadow:0 12px 30px rgba(6,182,212,0.08);
}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);font-weight:600}
.small{font-size:13px;color:var(--muted)}

/* ---------------------------
   RESISTOR VISUAL (3D look)
   --------------------------- */
.resistor-wrap{
  display:flex;
  align-items:center;
  justify-content:center;
  padding:16px 12px;
}
.resistor{
  width:100%;
  max-width:520px;
  height:96px;
  border-radius:50px;
  position:relative;
  padding:14px 28px;
  display:flex;
  align-items:center;
  justify-content:center;
  background: linear-gradient(180deg,#fbf7eb 0%, #efe3c8 100%);
  box-shadow:
    0 18px 60px rgba(2,6,23,0.6),
    inset 0 -12px 30px rgba(0,0,0,0.22);
  transform-style:preserve-3d;
  overflow:hidden;
}
.resistor::before, .resistor::after{
  content:'';
  position:absolute;
  width:70px;height:12px;border-radius:8px;
  background:linear-gradient(90deg,#b0b0b0,#6b6b6b);
  left:-90px; top:50%; transform:translateY(-50%);
  box-shadow:0 6px 20px rgba(0,0,0,0.5);
}
.resistor::after{ right:-90px; left:auto; transform:translateY(-50%) rotate(0deg); }

/* center body shine */
.resistor .shine{
  position:absolute;left:0;right:0;top:0;height:50%;
  background: linear-gradient(180deg, rgba(255,255,255,0.25), rgba(255,255,255,0.03));
  mix-blend-mode:soft-light;pointer-events:none;
}

/* Band style */
.band{
  width:22px;height:78px;border-radius:6px;margin:0 8px;box-shadow: inset 0 -6px 16px rgba(0,0,0,0.25);
  transition:transform 450ms cubic-bezier(.2,.9,.2,1), box-shadow 300ms;
  display:flex;align-items:center;justify-content:center;
  border:1px solid rgba(255,255,255,0.04);
  position:relative;
}
.band-label{
  position:absolute;bottom:-28px;font-size:12px;color:var(--muted);
  white-space:nowrap;
  transform-origin:center;
}

/* animated glow for active band */
.band.glow{
  transform: translateY(-6px) scale(1.04);
  box-shadow: 0 14px 40px rgba(79,70,229,0.15), inset 0 -6px 16px rgba(0,0,0,0.32);
}

/* ---------------------------
   RESULTS & INFO
   --------------------------- */
.results{
  margin-top:12px;display:flex;flex-direction:column;gap:8px;
}
.result-card{
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);
  display:flex;justify-content:space-between;align-items:center;gap:8px;
}
.result-card h4{margin:0;font-size:14px}
.result-value{font-weight:800;font-size:16px;color:#f8fafc}

/* small animated counter */
.counter{font-feature-settings: 'tnum'; font-variant-numeric: tabular-nums;}

/* ---------------------------
   SIDE PANEL (LEGEND)
   --------------------------- */
.side{
  display:flex;flex-direction:column;gap:12px;
  align-self:flex-start;
}
.legend{
  display:grid;grid-template-columns:repeat(2,1fr);gap:8px;
}
.legend-item{
  display:flex;gap:8px;align-items:center;padding:8px;border-radius:8px;
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
  border:1px solid rgba(255,255,255,0.02);
}
.color-dot{
  width:36px;height:22px;border-radius:6px;border:1px solid rgba(0,0,0,0.25);
  flex-shrink:0;
}
.legend-item .txt{font-size:13px;color:var(--muted)}

/* ---------------------------
   TABLE
   --------------------------- */
.table-wrap{overflow:auto;border-radius:8px}
table{width:100%;border-collapse:collapse;margin-top:8px;font-size:13px}
th,td{text-align:left;padding:10px;border-bottom:1px solid rgba(255,255,255,0.03)}
th{color:var(--muted);font-weight:700}

/* ---------------------------
   FOOTER
   --------------------------- */
.footer{grid-column:1/-1;text-align:center;color:var(--muted);font-size:13px;margin-top:12px}
</style>
</head>
<body>
  <div class="app">
    <div class="header">
      <div class="brand">
        <div class="logo">RC</div>
        <div class="title">
          <h1>Calculadora â€” Codi de Colors (4 bandes)</h1>
          <p>InterfÃ­cie visual i educativa Â· Tot en catalÃ  Â· Fitxer autÃ²nom</p>
        </div>
      </div>
      <div class="small">VersiÃ³ visual â€” Exporta `index.html` al teu GitHub</div>
    </div>

    <!-- MAIN CARD -->
    <div class="card">
      <div class="controls">
        <div class="mode-switch" role="tablist" aria-label="Modes">
          <button id="btnModeColors" class="switch-btn active" role="tab" aria-selected="true">ðŸŽ¨ Colors â†’ Valor</button>
          <button id="btnModeValue" class="switch-btn" role="tab">ðŸ”¢ Valor â†’ Colors</button>
          <button id="btnModeTheory" class="switch-btn" role="tab">ðŸ“˜ Teoria</button>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <div class="small">Tema: <strong>Fosc modern</strong></div>
          <button id="btnReset" class="switch-btn">Restableix</button>
        </div>
      </div>

      <!-- COLORS -> VALUE -->
      <div id="panelColors">
        <div style="display:flex;gap:12px;flex-direction:column">
          <div class="form-grid">
            <div>
              <label for="band1">1a xifra</label>
              <select id="band1"></select>
            </div>
            <div>
              <label for="band2">2a xifra</label>
              <select id="band2"></select>
            </div>
            <div>
              <label for="band3">Multiplicador</label>
              <select id="band3"></select>
            </div>
            <div>
              <label for="band4">TolerÃ ncia</label>
              <select id="band4"></select>
            </div>
          </div>

          <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
            <button id="btnCalcColors" class="btn">Calcular</button>
            <button id="btnToValue" class="btn ghost">Canvia a Valor â†’ Colors</button>
            <div class="small">DesprÃ©s de calcular, veureu el resistor i els resultats a sota.</div>
          </div>

          <div class="resistor-wrap card" aria-hidden="true">
            <div class="resistor" id="resistorVisual">
              <div class="shine"></div>
              <!-- bands injected here -->
            </div>
          </div>

          <div class="results" id="resultsColors">
            <!-- result cards -->
          </div>
        </div>
      </div>

      <!-- VALUE -> COLORS -->
      <div id="panelValue" style="display:none">
        <div style="display:flex;flex-direction:column;gap:10px">
          <div style="display:flex;gap:12px;flex-wrap:wrap;align-items:center">
            <div style="flex:1">
              <label for="valueInput">Valor nominal</label>
              <input id="valueInput" type="text" placeholder="Ex: 4k7, 4700, 2.2M">
            </div>
            <div style="width:160px">
              <label for="toleranceSelect">TolerÃ ncia (%)</label>
              <select id="toleranceSelect"></select>
            </div>
            <div style="display:flex;gap:8px;align-items:center">
              <button id="btnCalcValue" class="btn">Calcular</button>
              <button id="btnToColors" class="btn ghost">Canvia a Colors â†’ Valor</button>
            </div>
          </div>

          <div class="resistor-wrap card" aria-hidden="true">
            <div class="resistor" id="resistorVisualValue"><div class="shine"></div></div>
          </div>

          <div class="results" id="resultsValue"></div>
        </div>
      </div>

      <!-- THEORY PANEL -->
      <div id="panelTheory" style="display:none">
        <h3 style="margin-top:0">Teoria i Taula de Colors</h3>
        <p class="small">Les resistÃ¨ncies de 4 bandes mostren dues xifres significatives, un multiplicador i una tolerÃ ncia. FÃ³rmula:</p>
        <p><strong>Valor nominal = (1a xifra Ã— 10 + 2a xifra) Ã— multiplicador</strong></p>
        <div class="table-wrap">
          <table id="colorTable" aria-describedby="taulaColors">
            <thead><tr><th>Color</th><th>1a/2a xifra</th><th>Multiplicador</th><th>TolerÃ ncia</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>

        <h4>Exemples i notes</h4>
        <ul class="small">
          <li><strong>4k7</strong> = 4,7 kÎ© = 4700 Î©. NotaciÃ³ habitual als manuals i etiquetes.</li>
          <li>Si el valor no encaixa amb una combinaciÃ³ de 4 bandes, l'eina ho indicarÃ .</li>
        </ul>
      </div>
    </div>

    <!-- SIDE PANEL -->
    <aside class="side">
      <div class="card">
        <h4 style="margin:0 0 8px 0">Llegenda de Colors</h4>
        <div class="legend" id="legend"></div>
      </div>

      <div class="card">
        <h4 style="margin:0 0 8px 0">Sortida RÃ pida</h4>
        <div class="small" id="quickOutput">Cap cÃ lcul encara.</div>
      </div>

      <div class="card">
        <h4 style="margin:0 0 8px 0">Accions</h4>
        <div style="display:flex;gap:8px;flex-direction:column">
          <button id="btnExport" class="btn ghost">Descarrega HTML</button>
          <button id="btnCopy" class="btn">Copia codi (portapapers)</button>
        </div>
      </div>
    </aside>

    <div class="footer small">Fitxer autÃ²nom Â· Tot en catalÃ  Â· Sense dependÃ¨ncies externes</div>
  </div>

<script>
/* ============================
   DATA
   ============================ */
const COLOR_CODES = {
  'Negre':   { value:0,  multiplier:1,        color:'#000000' },
  'MarrÃ³':   { value:1,  multiplier:10,       tolerance:1,  color:'#8B4513' },
  'Vermell': { value:2,  multiplier:100,      tolerance:2,  color:'#FF0000' },
  'Taronja': { value:3,  multiplier:1000,     color:'#FFA500' },
  'Groc':    { value:4,  multiplier:10000,    color:'#FFD400' },
  'Verd':    { value:5,  multiplier:100000,   tolerance:0.5, color:'#00A86B' },
  'Blau':    { value:6,  multiplier:1000000,  tolerance:0.25, color:'#0077FF' },
  'Violeta': { value:7,  /*multiplier not*/ tolerance:0.1, color:'#B86BFF' },
  'Gris':    { value:8,  color:'#808080' },
  'Blanc':   { value:9,  color:'#F3F4F6' },
  'Or':      { multiplier:0.1,  tolerance:5,  color:'#FFD700' },
  'Plata':   { multiplier:0.01, tolerance:10, color:'#C0C0C0' },
  'Sense color': { tolerance:20, color:'transparent' }
};
const ORDER = ['Negre','MarrÃ³','Vermell','Taronja','Groc','Verd','Blau','Violeta','Gris','Blanc','Or','Plata','Sense color'];
const BANDS_1_2 = ['Negre','MarrÃ³','Vermell','Taronja','Groc','Verd','Blau','Violeta','Gris','Blanc'];
const MULTS = ['Negre','MarrÃ³','Vermell','Taronja','Groc','Verd','Blau','Or','Plata'];
const TOLS = ['MarrÃ³','Vermell','Verd','Blau','Violeta','Or','Plata','Sense color'];

/* ============================
   HELPERS
   ============================ */
const $ = id => document.getElementById(id);
function createEl(tag, props={}, children=[]){
  const e = document.createElement(tag);
  Object.assign(e, props);
  (children||[]).forEach(c=>e.appendChild(c));
  return e;
}
function formatOhms(v){
  if (!isFinite(v)) return 'â€”';
  const abs=Math.abs(v);
  if (abs>=1_000_000) return (v/1_000_000).toFixed(3).replace(/\.?0+$/,'')+' MÎ©';
  if (abs>=1000) return (v/1000).toFixed(3).replace(/\.?0+$/,'')+' kÎ©';
  return v.toFixed(2).replace(/\.00$/,'')+' Î©';
}
function findColorBy(type,target){
  for(const k in COLOR_CODES){
    const d=COLOR_CODES[k];
    if(type==='value' && d.value===target) return k;
    if(type==='multiplier' && d.multiplier===target) return k;
    if(type==='tolerance' && d.tolerance===target) return k;
  }
  return null;
}

/* parse inputs like 4k7, 4.7k, 4700, 2.2M */
function parseNominalInput(s){
  if(!s) return NaN;
  let t=String(s).trim().toLowerCase().replace(',', '.');
  // compact like 4k7 -> 4.7k
  const mk = t.match(/^(\d+)[k]([0-9])$/);
  if(mk) t = mk[1]+'.'+mk[2]+'k';
  const mm = t.match(/^(\d+)[m]([0-9])$/);
  if(mm) t = mm[1]+'.'+mm[2]+'m';
  if(t.endsWith('k')) return parseFloat(t.slice(0,-1))*1000;
  if(t.endsWith('m')) return parseFloat(t.slice(0,-1))*1000000;
  const n=parseFloat(t);
  return isNaN(n)?NaN:n;
}

/* find bands from value */
function findBandsFromValue(target){
  if(!(target>0)) return {error:'Valor no vÃ lid'};
  const mulVals = MULTS.map(c=>COLOR_CODES[c].multiplier).filter(x=>x!==undefined).sort((a,b)=>b-a);
  for(const mul of mulVals){
    const core = target/mul;
    if(core>=10 && core<100){
      const rounded = Math.round(core);
      if(rounded<10||rounded>99) continue;
      const b1=Math.floor(rounded/10);
      const b2=rounded%10;
      const band1=findColorBy('value',b1);
      const band2=findColorBy('value',b2);
      const band3=findColorBy('multiplier',mul);
      if(band1 && band2 && band3) return {band1,band2,band3,coreRounded:rounded};
    }
  }
  return {error:"No s'ha trobat una combinaciÃ³ de 4 bandes per a aquest valor."};
}

/* animate counter */
function animateCounter(el, from, to, duration=700){
  const start = performance.now();
  const step = (now)=>{
    const t = Math.min(1,(now-start)/duration);
    const val = from + (to-from)*t;
    el.textContent = val>=1000?formatOhms(Math.round(val)):formatOhms(val);
    if(t<1) requestAnimationFrame(step);
  };
  requestAnimationFrame(step);
}

/* ============================
   UI INIT
   ============================ */
function populateSelect(selectEl, arr){
  selectEl.innerHTML='';
  arr.forEach(name=>{
    const opt=document.createElement('option'); opt.value=name; opt.textContent=name;
    selectEl.appendChild(opt);
  });
}
populateSelect($('band1'), BANDS_1_2);
populateSelect($('band2'), BANDS_1_2);
populateSelect($('band3'), MULTS);
populateSelect($('band4'), TOLS);
populateSelect($('toleranceSelect'), TOLS);

function buildLegend(){
  const legend = document.getElementById('legend');
  ORDER.forEach(name=>{
    const item = createEl('div',{className:'legend-item'});
    const dot = createEl('div',{className:'color-dot'});
    dot.style.background = COLOR_CODES[name].color || 'transparent';
    const txt = createEl('div',{className:'txt'},[]);
    txt.textContent = name;
    item.appendChild(dot); item.appendChild(txt);
    legend.appendChild(item);
  });
}
buildLegend();

function buildColorTable(){
  const tbody = document.querySelector('#colorTable tbody');
  ORDER.forEach(name=>{
    const d = COLOR_CODES[name]||{};
    const tr = document.createElement('tr');
    const td1 = document.createElement('td'); td1.innerHTML = `<div style="display:flex;gap:8px;align-items:center"><span style="width:36px;height:18px;border-radius:6px;background:${d.color||'transparent'};display:inline-block;border:1px solid rgba(0,0,0,0.2)"></span>${name}</div>`;
    const td2 = document.createElement('td'); td2.textContent = d.value!==undefined?d.value:'-';
    const td3 = document.createElement('td'); td3.textContent = d.multiplier!==undefined?('Ã—'+d.multiplier):'-';
    const td4 = document.createElement('td'); td4.textContent = d.tolerance!==undefined?('Â±'+d.tolerance+'%'):'-';
    tr.appendChild(td1); tr.appendChild(td2); tr.appendChild(td3); tr.appendChild(td4);
    tbody.appendChild(tr);
  });
}
buildColorTable();

/* ============================
   RENDER RESISTOR
   ============================ */
function createBandDiv(colorName,label){
  const d = document.createElement('div');
  d.className='band';
  const c = COLOR_CODES[colorName] ? COLOR_CODES[colorName].color : 'transparent';
  d.style.background = c === 'transparent' ? 'linear-gradient(180deg, rgba(0,0,0,0.06), rgba(255,255,255,0.02))' : c;
  if(c === '#FFD400' || c === '#F3F4F6') d.style.border = '1px solid rgba(0,0,0,0.25)';
  const lbl = document.createElement('div'); lbl.className='band-label'; lbl.textContent = label||'';
  d.appendChild(lbl);
  return d;
}

function renderResistor(containerId, bands, labels){
  const container = $(containerId);
  container.innerHTML='';
  const spacer = document.createElement('div'); spacer.style.width='20px';
  const wrapper = document.createElement('div'); wrapper.style.display='flex'; wrapper.style.alignItems='center'; wrapper.style.justifyContent='center';
  wrapper.style.gap='8px';
  bands.forEach((b,i)=>{
    const bd = createBandDiv(b, labels && labels[i] ? labels[i] : b);
    // add glow class briefly
    bd.classList.add('glow');
    wrapper.appendChild(bd);
    setTimeout(()=>bd.classList.remove('glow'),600);
  });
  container.appendChild(wrapper);
}

/* ============================
   CALCULATIONS
   ============================ */
function calculateFromColors(){
  const b1 = $('band1').value;
  const b2 = $('band2').value;
  const b3 = $('band3').value;
  const b4 = $('band4').value;
  const out = $('resultsColors'); out.innerHTML='';
  if(!b1 || !b2 || !b3 || !b4){
    out.innerHTML = '<div class="result-card">Selecciona tots els colors per calcular.</div>';
    return;
  }
  const v1 = COLOR_CODES[b1].value;
  const v2 = COLOR_CODES[b2].value;
  const mul = COLOR_CODES[b3].multiplier;
  const tol = COLOR_CODES[b4].tolerance;
  if(v1===undefined||v2===undefined||mul===undefined||tol===undefined){
    out.innerHTML = '<div class="result-card">SelecciÃ³ incompleta o color no vÃ lid.</div>';
    return;
  }
  const firstTwo = (v1*10)+v2;
  const nominal = firstTwo * mul;
  const tolValue = nominal * (tol/100);
  const min = nominal - tolValue;
  const max = nominal + tolValue;

  // results
  out.appendChild(Object.assign(document.createElement('div'),{className:'result-card',innerHTML:`<div><h4>Valor nominal</h4><div class="small">Calculat a partir de les bandes</div></div><div class="result-value counter" id="nominalVal">â€”</div>`}));
  out.appendChild(Object.assign(document.createElement('div'),{className:'result-card',innerHTML:`<div><h4>TolerÃ ncia</h4><div class="small">Percentatge i valor absolut</div></div><div class="result-value">Â± ${tol}% â€” ${formatOhms(tolValue)}</div>`}));
  out.appendChild(Object.assign(document.createElement('div'),{className:'result-card',innerHTML:`<div><h4>Rang</h4><div class="small">MÃ­nim / MÃ xim</div></div><div class="result-value">${formatOhms(min)} / ${formatOhms(max)}</div>`}));

  // animate nominal value
  const nominalEl = document.getElementById('nominalVal');
  animateCounter(nominalEl, 0, nominal, 700);

  // render resistor visual
  renderResistor('resistorVisual', [b1,b2,b3,b4], ['1a','2a','x','tol']);

  // quick output
  $('quickOutput').textContent = `${formatOhms(nominal)} (Â±${tol}%) â€” ${b1}, ${b2}, ${b3}, ${b4}`;
}

$('btnCalcColors').addEventListener('click', calculateFromColors);

/* VALUE -> COLORS */
function calculateFromValue(){
  const raw = $('valueInput').value;
  const tolSel = $('toleranceSelect').value;
  const out = $('resultsValue'); out.innerHTML='';
  if(!raw){
    out.innerHTML = '<div class="result-card">Introdueix un valor.</div>';
    return;
  }
  if(!tolSel){
    out.innerHTML = '<div class="result-card">Selecciona una tolerÃ ncia.</div>';
    return;
  }
  const nominal = parseNominalInput(raw);
  if(!nominal || isNaN(nominal) || nominal<=0){
    out.innerHTML = '<div class="result-card">Valor nominal invÃ lid. Exemple vÃ lid: 4k7, 4700, 2.2M</div>';
    return;
  }
  const found = findBandsFromValue(nominal);
  if(found.error){
    out.innerHTML = `<div class="result-card">${found.error}</div>`;
    return;
  }
  const band1 = found.band1;
  const band2 = found.band2;
  const band3 = found.band3;
  const band4 = tolSel;

  out.appendChild(Object.assign(document.createElement('div'),{className:'result-card',innerHTML:`<div><h4>Colors</h4><div class="small">Bandes calculades</div></div><div class="result-value">${band1} Â· ${band2} Â· ${band3} Â· ${band4}</div>`}));
  out.appendChild(Object.assign(document.createElement('div'),{className:'result-card',innerHTML:`<div><h4>InterpretaciÃ³</h4><div class="small">CÃ lcul intern</div></div><div class="result-value">${Math.floor(found.coreRounded/10)} ${found.coreRounded%10} Ã— ${COLOR_CODES[band3].multiplier} = ${formatOhms(Math.round(found.coreRounded*COLOR_CODES[band3].multiplier))}</div>`}));

  renderResistor('resistorVisualValue',[band1,band2,band3,band4], ['1a','2a','x','tol']);
  $('quickOutput').textContent = `${band1}, ${band2}, ${band3}, ${band4} â†’ ${formatOhms(nominal)} (Â± ${COLOR_CODES[band4].tolerance}% )`;
}
$('btnCalcValue').addEventListener('click', calculateFromValue);

/* ============================
   MODE SWITCHING, RESET, EXPORT
   ============================ */
function showPanel(panel){
  $('panelColors').style.display = panel==='colors'?'block':'none';
  $('panelValue').style.display = panel==='value'?'block':'none';
  $('panelTheory').style.display = panel==='theory'?'block':'none';
  ['btnModeColors','btnModeValue','btnModeTheory'].forEach(id=>$(id).classList.remove('active'));
  if(panel==='colors') $('btnModeColors').classList.add('active');
  if(panel==='value') $('btnModeValue').classList.add('active');
  if(panel==='theory') $('btnModeTheory').classList.add('active');
}
$('btnModeColors').addEventListener('click',()=>showPanel('colors'));
$('btnModeValue').addEventListener('click',()=>showPanel('value'));
$('btnModeTheory').addEventListener('click',()=>showPanel('theory'));

$('btnReset').addEventListener('click',()=>{
  $('band1').value='Groc'; $('band2').value='Violeta'; $('band3').value='Taronja'; $('band4').value='Or';
  $('valueInput').value='4k7'; $('toleranceSelect').value='Or';
  calculateFromColors();
});

/* fill default and calculate */
$('band1').value='Groc'; $('band2').value='Violeta'; $('band3').value='Taronja'; $('band4').value='Or';
$('valueInput').value='4k7'; $('toleranceSelect').value='Or';
calculateFromColors();

/* populate tolerance select with label names */
TOLS.forEach(t=>{ const o=document.createElement('option'); o.value=t; o.textContent = t; $('toleranceSelect').appendChild(o); });

/* export: download the current HTML page as file */
$('btnExport').addEventListener('click', ()=>{
  const blob = new Blob([document.documentElement.outerHTML], {type:'text/html;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'index.html';
  document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
});

/* copy to clipboard */
$('btnCopy').addEventListener('click', async ()=>{
  try{
    await navigator.clipboard.writeText(document.documentElement.outerHTML);
    alert('Codi HTML copiat al portapapers!');
  }catch(e){
    alert('No s\'ha pogut copiar. Descarrega el fitxer.');
  }
});
</script>
</body>
</html>
